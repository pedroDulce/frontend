<div class="chat-widget" [class.collapsed]="isCollapsed">
  <div class="chat-header" (click)="toggleChat()">
    <h3>ðŸ’¬ QA Assistant</h3>
    <button class="toggle-btn" (click)="toggleChat(); $event.stopPropagation()">
      {{ isCollapsed ? 'â†‘' : 'â†“' }}
    </button>
  </div>

  <div class="chat-content" *ngIf="!isCollapsed">
    <div class="messages-container">
      <div *ngFor="let msg of messages; trackBy: trackByFn" 
           class="message" 
           [class.user-message]="msg.type === 'user'"
           [class.assistant-message]="msg.type === 'assistant'">
        
        <div class="message-avatar">
          {{ msg.type === 'user' ? 'ðŸ‘¤' : 'ðŸ¤–' }}
        </div>
        
        <div class="message-content">
          <!-- Texto del mensaje -->
          <div class="message-text">{{ msg.text }}</div>
          
          <!-- Timestamp -->
          <div class="message-time">{{ msg.timestamp | date:'HH:mm' }}</div>
          
          <!-- AQUÃ VAN LAS SUGERENCIAS - CON NUEVO ESTILO -->
          <div class="suggestions" *ngIf="msg.suggestions && msg.suggestions.length > 0 && msg.type === 'assistant'">
            <div class="suggestions-label">Â¿Te interesa?</div>
            <div class="suggestions-grid">
              <button *ngFor="let suggestion of msg.suggestions" 
                      class="suggestion-btn-modern"
                      (click)="useSuggestion(suggestion)">
                <i class="suggestion-icon"></i>
                {{ suggestion }}
              </button>
            </div>
          </div>
          
          <!-- AQUÃ VAN LAS FUENTES -->
          <div class="sources" *ngIf="msg.sources && msg.sources.length > 0 && msg.type === 'assistant'">
            <div class="sources-label">Fuentes:</div>
            <div *ngFor="let source of msg.sources" class="source-item">
              <span class="source-icon">ðŸ“š</span>
              <span class="source-text">{{ getSourceDisplay(source) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicador de carga -->
      <div class="loading-indicator" *ngIf="loading">
        <div class="typing-animation">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span>Procesando pregunta...</span>
      </div>
    </div>

    <!-- Input y controles - CON NUEVO ESTILO -->
    <div class="input-section">
      <div class="input-container-modern">
        <input type="text" 
               class="question-input-modern"
               [(ngModel)]="userInput" 
               (keyup.enter)="sendMessage()"
               placeholder="Escribe tu pregunta sobre QA..."
               [disabled]="loading">
        <button class="send-btn-modern" 
                (click)="sendMessage()" 
                [disabled]="loading || !userInput.trim()">
          <i class="send-icon"></i>
          <div class="spinner-modern" *ngIf="loading"></div>
        </button>
      </div>
      
      <!-- Botones de acciÃ³n - ACTUALIZADOS -->
      <div class="action-buttons-modern">
        <button class="action-btn-modern clear-btn" 
                (click)="clearChat()" 
                title="Limpiar chat">
          <i class="action-icon clear-icon"></i>
          Limpiar
        </button>
        <button class="action-btn-modern minimize-btn" 
                (click)="toggleChat()" 
                title="Minimizar">
          <i class="action-icon minimize-icon"></i>
          Minimizar
        </button>
      </div>
    </div>
  </div>
</div>