<div class="chat-widget" [class.collapsed]="isCollapsed">
  <div class="chat-header" (click)="toggleChat()">
    <h3>ğŸ’¬ QA Assistant</h3>
    <button class="toggle-btn" (click)="toggleChat(); $event.stopPropagation()">
      {{ isCollapsed ? 'â†‘' : 'â†“' }}
    </button>
  </div>

  <div class="chat-content" *ngIf="!isCollapsed">
    <div class="messages-container">
      <div *ngFor="let msg of messages; trackBy: trackByFn" 
           class="message" 
           [class.user-message]="msg.type === 'user'"
           [class.assistant-message]="msg.type === 'assistant'">
        
        <div class="message-avatar">
          {{ msg.type === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–' }}
        </div>
        
        <div class="message-content">
          <!-- Texto del mensaje -->
          <div class="message-text">{{ msg.text }}</div>
          
          <!-- Timestamp -->
          <div class="message-time">{{ msg.timestamp | date:'HH:mm' }}</div>
          
          <!-- AQUÃ VAN LAS SUGERENCIAS -->
          <div class="suggestions" *ngIf="msg.suggestions && msg.suggestions.length > 0 && msg.type === 'assistant'">
            <div class="suggestions-label">Â¿Te interesa?</div>
            <button *ngFor="let suggestion of msg.suggestions" 
                    class="suggestion-btn"
                    (click)="useSuggestion(suggestion)">
              {{ suggestion }}
            </button>
          </div>
          
          <!-- AQUÃ VAN LAS FUENTES - ESTO ES LO NUEVO -->
          <div class="sources" *ngIf="msg.sources && msg.sources.length > 0 && msg.type === 'assistant'">
            <div class="sources-label">Fuentes:</div>
            <div *ngFor="let source of msg.sources" class="source-item">
              <span class="source-icon">ğŸ“š</span>
              <span class="source-text">{{ getSourceDisplay(source) }}</span>
            </div>
          </div>
          <!-- FIN DEL CÃ“DIGO NUEVO -->
          
        </div>
      </div>

      <!-- Indicador de carga -->
      <div class="loading-indicator" *ngIf="loading">
        <div class="typing-animation">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span>Procesando pregunta...</span>
      </div>
    </div>

    <!-- Input y controles -->
    <div class="input-section">
      <div class="input-container">
        <input type="text" 
               [(ngModel)]="userInput" 
               (keyup.enter)="sendMessage()"
               placeholder="Escribe tu pregunta sobre QA..."
               [disabled]="loading">
        <button class="send-btn" 
                (click)="sendMessage()" 
                [disabled]="loading || !userInput.trim()">
          <span *ngIf="!loading">â¤</span>
          <div class="spinner" *ngIf="loading"></div>
        </button>
      </div>
      
      <!-- Botones de acciÃ³n -->
      <div class="action-buttons">
        <button class="action-btn" (click)="clearChat()" title="Limpiar chat">
          ğŸ—‘ï¸ Limpiar
        </button>
        <button class="action-btn" (click)="toggleChat()" title="Minimizar">
          ğŸ“Œ Minimizar
        </button>
      </div>
    </div>
  </div>
</div>