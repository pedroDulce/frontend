<!-- qa-chat-assistant.component.html -->
<div class="chat-widget" [class.collapsed]="isCollapsed">
  <div class="chat-header" (click)="toggleChat()">
    <h3>ğŸ’¬ QA Assistant</h3>
    <div class="server-status" [class.online]="serverAvailable" [class.offline]="!serverAvailable">
      {{ serverAvailable ? 'ğŸŸ¢' : 'ğŸ”´' }}
    </div>
    <button class="toggle-btn" (click)="toggleChat(); $event.stopPropagation()">
      {{ isCollapsed ? 'â†‘' : 'â†“' }}
    </button>
  </div>

  <div class="chat-content" *ngIf="!isCollapsed">
    <!-- Mensaje de sistema si el servidor estÃ¡ caÃ­do -->
    <div class="system-alert" *ngIf="!serverAvailable">
      <div class="alert-icon">âš ï¸</div>
      <div class="alert-text">
        <strong>Servidor no disponible</strong>
        <br>
        Verifica que el backend estÃ© ejecutÃ¡ndose en http://localhost:8080
      </div>
    </div>

    <div class="messages-container">
      <div *ngFor="let msg of messages; trackBy: trackByFn" 
           class="message" 
           [class.user-message]="msg.type === 'user'"
           [class.assistant-message]="msg.type === 'assistant'"
           [class.system-message]="msg.type === 'system'"
           [class.error-message]="msg.isError">
        
        <div class="message-avatar">
          <span *ngIf="msg.type === 'user'">ğŸ‘¤</span>
          <span *ngIf="msg.type === 'assistant' && !msg.isError">ğŸ¤–</span>
          <span *ngIf="msg.type === 'assistant' && msg.isError">âŒ</span>
          <span *ngIf="msg.type === 'system'">âš™ï¸</span>
        </div>
        
        <div class="message-content">
          <!--<div class="message-text">{{ msg.text }}</div>-->
          <div class="message-text" [innerHTML]="msg.text"></div>
          <div class="message-time">{{ msg.timestamp | date:'HH:mm' }}</div>
                    
          <!-- En sugerencias, asegurar un solo click -->
        <div class="suggestions" *ngIf="msg.suggestions && msg.suggestions.length > 0">
          <div class="suggestions-label">Acciones:</div>
          <div class="suggestions-grid">
            <button *ngFor="let suggestion of msg.suggestions" 
                    class="suggestion-btn-modern"
                    (click)="useSuggestion(suggestion); $event.stopPropagation()"
                    [disabled]="loading">
              {{ suggestion }}
            </button>
          </div>
        </div>
        </div>
      </div>

      <!-- Loading indicator -->
      <div class="loading-indicator" *ngIf="loading">
        <div class="typing-animation">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span>Conectando con el servidor...</span>
      </div>
    </div>

    <!-- Input section -->
    <div class="input-section">
      <div class="input-container-modern">
        <input type="text" 
               class="question-input-modern"
               [(ngModel)]="userInput" 
               (keyup.enter)="!loading && sendMessage()"
               placeholder="Escribe tu pregunta sobre QA..."
               [disabled]="loading || !serverAvailable">
        <button class="send-btn-modern" 
                (click)="sendMessage()" 
                [disabled]="loading || !userInput.trim() || !serverAvailable"
                [class.disabled]="!serverAvailable">
          <i class="send-icon" *ngIf="!loading"></i>
          <div class="spinner-modern" *ngIf="loading"></div>
        </button>
      </div>
      
      <div class="action-buttons-modern">
        <button class="action-btn-modern clear-btn" 
                (click)="clearChat()" 
                title="Limpiar chat">
          <i class="action-icon clear-icon"></i>
          Limpiar
        </button>
        <button class="action-btn-modern" 
                (click)="checkServerConnection()" 
                title="Verificar conexiÃ³n">
          <i class="action-icon">ğŸ”</i>
          Verificar ConexiÃ³n
        </button>
      </div>
    </div>
  </div>
</div>